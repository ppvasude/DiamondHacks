

# DevOps-Project
## Setup
First, clone this repository.
Navigate inside */web_srv/* , do `Vagrant up` .
Navigate inside */ansible_srv*, open the `Vagrantfile` and do the following :

 - Set `<Your local ansible_srv path>` to the path of this ansible_srv folder on your local.
 - Set `<Your private_key path>` to the path of the private_key on your local which will be required to connect to web_srv. If you are setting up *web_srv* using vagrant, this will usually be `<Your path till web_srv/web_srv/.vagrant/machines/default/virtualbox>` .
 - Make sure this private key is named as `private_key` .

Run `Vagrant Up` and `Vagrant ssh` .

Basically now the VM formed through *ansible_srv* will be the **ansible server**, and will contain all the ansible playbooks. Inside the VM, do `cd /ansible_srv`

Run `ansible-playbook ssh-playbook.yml`

The VM formed through *web_srv* will be the **jenkins server**. All the ansible playbooks will make changes on this machine and it will set up the jenkins server, configure checkboxio and iTrust builds, and contain the git hooks.

## Jenkins setup and automation

Run `ansible-playbook -i inventory setup-jenkins.yml` .

The *setup-jenkins.yml* internally will call the following :

 - *install-jenkins.yml* : This calls a role - *jenkins*. This role has been defined in `/roles/jenkins/tasks/main.yml`. This role will install Java JDK 8, import jenkins key, add jenkins repository to apt and install jenkins accordingly.
 - *configure-jenkins.yml* : This role is responsible for configuring jenkins. It will add a new user using admin credentials as specified in the script. You can change var `username` and var `user_pwd` to set your username and password on the newly created user. It internally uses the admin password which is in `/var/lib/jenkins/secrets/initialAdminPassword` and is by default generated by jenkins.

You can test this by going to [http://192.168.33.100:8080/](http://192.168.33.100:8080/) . 
You should see the jenkins web ui come up. You can login using the admin credentials or your newly created user.
## Automatically setup build jobs
We are joing to use **jenkins-job-builder** inorder to build jobs for **checkbox.io** and **iTrust**
### Checkbox.io
Run the playbook *install-jjb.yml*
This playbook contains - 
Installation of **nodejs, npm and Jenkins Job builder**.
Inorder to build the job, you need to give the credentials in *jenkins_jobs.ini* file so that you get the access to create the build job on jenkins.
There is a jenkins job file placed inside `/jobs` directory - *checkbox-build.yml* which builds the checkbox.io repo by running `npm test` in the *checkbox.io-build-workspace/server-side/site/* directory.
And later the playbook runs `jenkins-jobs update jobs` command to create the build for the job files inside `/jobs` directory.
After running this playbook, go to the browser `http://192.168.33.100:8080` and you can see the build job created once you login - 

    ** Screenshot **
Click on **`Build now`** and you can see the Build success results - 

    ** Screenshot **

### iTrust
**  jerry's part  **
## Git hook to trigger a build
